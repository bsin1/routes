import { useEffect } from "react"
import styles from "src/react/styles/MapboxMap.module.css"
import mapboxgl from "mapbox-gl"

const MapboxMap = () => {
  let map: mapboxgl.Map | null = null
  const defaultLat = 0.66259620645024
  const defaultLng = -0.73141638294691
  const defaultZoom = 11
  const ores = [
    { x: 7924.891, y: 1923.526 },
    { x: 7953.128, y: 1798.516 },
    { x: 7953.56, y: 1795.344 },
    { x: 8003.92, y: 1812.732 },
    { x: 8014.803, y: 1810.499 },
    { x: 8014.096, y: 1748.879 },
    { x: 8066.034, y: 1753.251 },
    { x: 8068.442, y: 1752.698 },
    { x: 8069.382, y: 1755.83 },
    { x: 8122.537, y: 1819.063 },
    { x: 8200.565, y: 1812.291 },
    { x: 8232.387, y: 1753.292 },
    { x: 8230.914, y: 1746.453 },
    { x: 8253.158, y: 1739.495 },
    { x: 8257.365, y: 1737.745 },
    { x: 8276.32, y: 1685.318 },
    { x: 8203.277, y: 1680.095 },
    { x: 8199.662, y: 1683.363 },
    { x: 8232.12, y: 1620.835 },
    { x: 8272.319, y: 1555.621 },
    { x: 8348.349, y: 1560.56 },
    { x: 8313.234, y: 1621.161 },
    { x: 8466.828, y: 1573.171 },
    { x: 8476.379, y: 1582.611 },
    { x: 8505.146, y: 1582.642 },
    { x: 8507.332, y: 1544.763 },
    { x: 8508.988, y: 1541.593 },
    { x: 8504.635, y: 1541.761 },
    { x: 8482.893, y: 1527.485 },
    { x: 8483.596, y: 1525.493 },
    { x: 8479.776, y: 1527.874 },
    { x: 8537.838, y: 1617.558 },
    { x: 8561.005, y: 1622.288 },
    { x: 8563.805, y: 1620.822 },
    { x: 8561.07, y: 1625.671 },
    { x: 8508.706, y: 1644.394 },
    { x: 8487.22, y: 1658.432 },
    { x: 8499.2, y: 1683.983 },
    { x: 8496.262, y: 1685.792 },
    { x: 8499.05, y: 1688.863 },
    { x: 8473.313, y: 1731.024 },
    { x: 8471.36, y: 1732.239 },
    { x: 8465.645, y: 1798.817 },
    { x: 8468.248, y: 1799.397 },
    { x: 8491.145, y: 1809.735 },
    { x: 8419.186, y: 1814.231 },
    { x: 8455.72, y: 1877.291 },
    { x: 8448.749, y: 1890.212 },
    { x: 8446.337, y: 1888.787 },
    { x: 8401.049, y: 1907.874 },
    { x: 8397.443, y: 1909.209 },
    { x: 8341.602, y: 1883.376 },
    { x: 8338.152, y: 1881.925 },
    { x: 8344.173, y: 1814.468 },
    { x: 8283.248, y: 1803.095 },
    { x: 8280.52, y: 1797.256 },
    { x: 8243, y: 1887 },
    { x: 8271.397, y: 1938.226 },
    { x: 8310.586, y: 1955.379 },
    { x: 8313.174, y: 1951.174 },
    { x: 8309.314, y: 2006.07 },
    { x: 8261.471, y: 2005.297 },
    { x: 8245.151, y: 2002.664 },
    { x: 8230.613, y: 1964.736 },
    { x: 8196.982, y: 1940.079 },
    { x: 8123.564, y: 1942.23 },
    { x: 8269.441, y: 2068.17 },
    { x: 8272.704, y: 2071.614 },
    { x: 8303, y: 2128 },
    { x: 8344.155, y: 2068.526 },
    { x: 8383, y: 2127 },
    { x: 8419.265, y: 2190.838 },
    { x: 8345.577, y: 2199.267 },
    { x: 8270, y: 2198 },
    { x: 8269, y: 2194 },
    { x: 8200, y: 2191 },
    { x: 8418.776, y: 2328.095 },
    { x: 8497, y: 2312 },
    { x: 8530.024, y: 2383.493 },
    { x: 8490, y: 2447 },
    { x: 8731.064, y: 2346.166 },
    { x: 8742.03, y: 2195.297 },
    { x: 8749.428, y: 2189.868 },
    { x: 8795.351, y: 2171.817 },
    { x: 8839.371, y: 2156.417 },
    { x: 8846.488, y: 2146.043 },
    { x: 8851.455, y: 2146.5 },
    { x: 8896.111, y: 2140.406 },
    { x: 8894.943, y: 2131.941 },
    { x: 8912.53, y: 2138.26 },
    { x: 8933.156, y: 2067.758 },
    { x: 8972.302, y: 2001.694 },
    { x: 9041.166, y: 1999.158 },
    { x: 9043, y: 2000 },
    { x: 9119, y: 2004 },
    { x: 9189.356, y: 2000.32 },
    { x: 9156, y: 2069 },
    { x: 9152.377, y: 2067.586 },
    { x: 9195.729, y: 2132.039 },
    { x: 9297.371, y: 2197.21 },
    { x: 9193.448, y: 2256.806 },
    { x: 9228.952, y: 2323.962 },
    { x: 9203.495, y: 2354.397 },
    { x: 9195.809, y: 2350.74 },
    { x: 9200.242, y: 2364.258 },
    { x: 9244.014, y: 2382.308 },
    { x: 9252.792, y: 2378.293 },
    { x: 9255.684, y: 2383.191 },
    { x: 9282.374, y: 2344.704 },
    { x: 9274.69, y: 2336.553 },
    { x: 9312.373, y: 2332.903 },
    { x: 9317.951, y: 2332.811 },
    { x: 9323.496, y: 2329.861 },
    { x: 9264.943, y: 2517.124 },
    { x: 9189.078, y: 2509.516 },
    { x: 9176.718, y: 2543.377 },
    { x: 9181.101, y: 2545.093 },
    { x: 9095.195, y: 2560.305 },
    { x: 9092.127, y: 2545.34 },
    { x: 9033.036, y: 2512.145 },
    { x: 9014.175, y: 2506.749 },
    { x: 9012.24, y: 2517.323 },
    { x: 9008, y: 2452 },
    { x: 9008, y: 2447 },
    { x: 9078.544, y: 2454.751 },
    { x: 9154.622, y: 2450.032 },
    { x: 9121.789, y: 2388.885 },
    { x: 9117.391, y: 2384.857 },
    { x: 9049.666, y: 2252.016 },
    { x: 9300, y: 2064 },
    { x: 9125.717, y: 1919.071 },
    { x: 9121.247, y: 1912.14 },
    { x: 9126.078, y: 1897.576 },
    { x: 9114.216, y: 1932.259 },
    { x: 9081.919, y: 1879.056 },
    { x: 9036.021, y: 1891.303 },
    { x: 9024.691, y: 1888.01 },
    { x: 8954.906, y: 1900.54 },
    { x: 8953.284, y: 1906.154 },
    { x: 8900.399, y: 1896.844 },
    { x: 8894.636, y: 1897.896 },
    { x: 8898.824, y: 1871.139 },
    { x: 8825.367, y: 1998.617 },
    { x: 8790.687, y: 2063.577 },
    { x: 8713.952, y: 2065.388 },
    { x: 8635.121, y: 2073.347 },
    { x: 8571.407, y: 2069.319 },
    { x: 8605.455, y: 2130.819 },
    { x: 8564.5, y: 2186.5 },
    { x: 8528.105, y: 2130.811 },
    { x: 8496, y: 2069 },
    { x: 8532.891, y: 2002.334 },
    { x: 8640.963, y: 2195.519 },
    { x: 8747.05, y: 1874.159 },
    { x: 8708, y: 1813 },
    { x: 8732.727, y: 1716.444 },
    { x: 8737.878, y: 1711.45 },
    { x: 8754.851, y: 1711.256 },
    { x: 8735.376, y: 1639.158 },
    { x: 8717.81, y: 1618.618 },
    { x: 8724.468, y: 1608.158 },
    { x: 8726.016, y: 1579.275 },
    { x: 8729.365, y: 1574.206 },
    { x: 8640.472, y: 1563.091 },
    { x: 8635.997, y: 1561.779 },
    { x: 8612.844, y: 1545.204 },
    { x: 8614.533, y: 1538.325 },
    { x: 8612.371, y: 1494.694 },
    { x: 8607.203, y: 1492.707 },
    { x: 8622.589, y: 1597.512 },
    { x: 8616.589, y: 1600.17 },
    { x: 8829, y: 1614 },
    { x: 8862.815, y: 1680.996 },
    { x: 9109.887, y: 1809.972 },
    { x: 9116.02, y: 1823.856 },
    { x: 9136.474, y: 1809.116 },
    { x: 9140.894, y: 1816.888 },
    { x: 9132.203, y: 1853.249 },
    { x: 9142.456, y: 1863.816 },
    { x: 8149.088, y: 1546.776 },
    { x: 8140.385, y: 1552.354 },
    { x: 8129.54, y: 1548.627 },
    { x: 8091, y: 1492 },
    { x: 8104.347, y: 1434.471 },
    { x: 8106.7, y: 1431.428 },
    { x: 8102.202, y: 1431.081 },
    { x: 8165.096, y: 1475.53 },
    { x: 8172.137, y: 1481.384 },
    { x: 8105.638, y: 1620.994 },
    { x: 8099.501, y: 1629.54 },
    { x: 8098.171, y: 1644.193 },
    { x: 8018, y: 1620 },
    { x: 8015.869, y: 1622.511 },
    { x: 7991.943, y: 1526.369 },
    { x: 7993.69, y: 1520.087 },
    { x: 7999.79, y: 1522.379 },
    { x: 8000.467, y: 1478.715 },
    { x: 8013.29, y: 1474.109 },
    { x: 8009.092, y: 1462.117 },
    { x: 8003.567, y: 1406.827 },
    { x: 8002.786, y: 1400.335 },
    { x: 8012.684, y: 1399.523 },
    { x: 7793, y: 1365 },
    { x: 7790.105, y: 1363.566 },
    { x: 7851.732, y: 1594.927 },
    { x: 7852.487, y: 1601.461 },
    { x: 7830.968, y: 1669.888 },
    { x: 7833.436, y: 1672.594 },
    { x: 7756, y: 1687 },
    { x: 7743.233, y: 1767.659 },
    { x: 7742.071, y: 1769.931 },
    { x: 7727.623, y: 1836.889 },
    { x: 7730.479, y: 1839.37 },
    { x: 7733.623, y: 1839.766 },
    { x: 7831.857, y: 1760.239 },
    { x: 7834.683, y: 1762.396 },
    { x: 7838.085, y: 1761.672 },
    { x: 7924.891, y: 1923.526 },
  ]

  useEffect(() => {
    loadMap()
  })

  const loadMap = () => {
    let token = process.env.REACT_APP_MAPBOX_TOKEN ?? ""
    console.log("GOT TOKEN: ", token)
    mapboxgl.accessToken = token
    //handleMapLoading(true)
    let container = document.getElementById("main-map")!

    let newMap = new mapboxgl.Map({
      container: container,
      style: "mapbox://styles/bsin1/ckuqizsi81ony14obdblcukec",
      preserveDrawingBuffer: true,
    })

    newMap.on("load", loadSources)

    //newMap.on("dragend", showProperties)

    //newMap.on("zoomend", showProperties)

    map = newMap
  }

  const loadMarkers = () => {
    ores.forEach((ore) => {
      if (map) {
        new mapboxgl.Marker()
          .setLngLat(new mapboxgl.LngLat(ore.y, ore.x))
          .addTo(map)
      }
    })
  }

  const loadSources = () => {
    if (map?.isStyleLoaded() === false) {
      setTimeout(() => {
        loadSources()
      }, 250)
    }

    loadMarkers()

    zoomToMapRegion(defaultLat, defaultLng, defaultZoom)
  }

  const zoomToMapRegion = (
    latitude: number,
    longitude: number,
    zoom: number
  ) => {
    map?.flyTo({
      center: new mapboxgl.LngLat(longitude, latitude),
      zoom: zoom,
    })

    setTimeout(() => {
      console.log("CURRENT ZOOM: ", map?.getZoom())
    }, 5000)
  }

  return (
    <div className={styles.MapboxMap}>
      <div className={styles.MapContainer}>
        <div id="main-map" className={styles.Map} />
      </div>
    </div>
  )
}

export default MapboxMap
